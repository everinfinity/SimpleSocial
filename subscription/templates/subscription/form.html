{% load wagtailcore_tags %}
{% load crispy_forms_tags %}

{{ page.intro | richtext }}

<form action="#" method="post" id="dynamicFields">
    <div class="form-row">
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="subscriptionType" id="recurring" value="recurring" @bind="subscriptionType">
            <label class="form-check-label" for="recurring">Recurring</label>
        </div>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="subscriptionType" id="once" value="once" @bind="subscriptionType">
            <label class="form-check-label" for="once">Once</label>
        </div>
    </div>

    <div class="form-row mt-3">
        <div :if="this.subscriptionType === 'recurring'">
            <label for="recurring_subscription_type">Subscription type</label>
            <select
                name="subscription_type"
                class="select form-control"
                required="" id="recurring_subscription_type">
                {% for plan in form.plans %}
                    <option value="{{ plan.id }}">{{ plan.name }} - ${{ plan.price }}</option>
                {% endfor %}
            </select>
        </div>
        <div :else>
            {{ form.subscription_type | as_crispy_field }}

            {{ form.duration | as_crispy_field }} 
        </div> 
    </div>

    <div class="form-row mt-3">
        <div class="col-md-5">
            {{ form.subscriber_given_name | as_crispy_field }}
        </div>
        <div class="col-md-5">
            {{ form.subscriber_family_name | as_crispy_field }}
        </div>   
    </div>

    <div class="form-row">
        <p class="p-3 mb-2 bg-info text-white col-md-10">PDF subscription will be emailed to <b>{{ user.get_username }}</b></p>
    </div>

    <div class="form-row">
        <div class="col-md-10">
            {{ form.subscriber_street_address | as_crispy_field }}
        </div>
    </div>

    <div class="form-row">
        <div class="col-md-10">
            {{ form.subscriber_street_address_line_2 | as_crispy_field }}
        </div>
    </div>

    <div class="form-row">
        <div class="form-group col-md-3 mb-0">
            {{ form.subscriber_address_locality | as_crispy_field }}
        </div>
        <div class="form-group col-md-3 mb-0">
            {{ form.subscriber_address_region | as_crispy_field }}
        </div>
        <div class="form-group col-md-3 mb-0">
            {{ form.subscriber_postal_code | as_crispy_field }}
        </div>
    </div>

    <div class="form-row">
        <div class="col-md-9">
            {{ form.subscriber_address_country | as_crispy_field }}
        </div>
    </div>

    <div class="text-right">
        <div class="btn-group" role="group" aria-label="Cart navigation">
            <button type="submit" class="btn btn-outline-primary">
                Subscribe
                <i class="fa fa-arrow-right ml-1"></i>
            </button>
        </div>
    </div>

    {% csrf_token %}
</form>

{% block extra_js %}
<script type="module">
    import Litedom from '//unpkg.com/litedom';

    Litedom({
        el: "#dynamicFields",
        data: {
            subscriptionType: "recurring",
        },
    })
</script>
{% endblock extra_js %}